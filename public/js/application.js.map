{"version":3,"names":[],"mappings":"","sources":["application.js"],"sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n'use strict';\n\n/**\n * Created by greatroad on 16/11/5.\n */\n$.ajaxSetup({\n    headers: {\n        'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n    }\n});\n\nfunction deleteCate(currentNode) {\n\n    $.ajax({\n        type: 'delete',\n        url: '/users/' + $('#wrap-id').data('user-id') + '/child_categories',\n        data: { _taken: $('meta[name=\"csrf-token\"]').attr('content') },\n        dataType: 'json',\n        success: function success(data) {\n            currentNode.parent().remove();\n        }\n    });\n}\n\nfunction addChildCate(currentNode) {\n    if ($(currentNode).parent().find('input').val() == '') {\n        $(currentNode).parent().find('input').focus();\n        $(currentNode).parent().append('<span class=\"text-danger\">子菜单不能能空</span>');\n    } else {\n        $.ajax({\n            type: 'post',\n            url: '/users/' + $('#user-card').data('user-id') + '/child_categories',\n            data: { parent_id: currentNode.parents('li').attr('data-category-id'), name: currentNode.parent().find('input').val() },\n            dataType: 'json',\n            success: function success(data) {\n                currentNode.parent().next().append('<li class=\"child-cate-list\" data-child-category-id=\"' + data.id + '\">' + data.name + '' + '<span><i class=\"fa fa-times\" aria-hidden=\"true\"></i></span>' + '</li>');\n                currentNode.parent().find('input').val('');\n            }\n        });\n    }\n};\n\n$(document).ready(function () {\n    $('#commentForm textarea').keydown(function (e) {\n        if ((e.ctrlKey || e.metaKey) && e.keyCode == 13) {\n            $(\"#commentBtn\").click();\n        }\n    });\n\n    $.ajaxSetup({\n        headers: {\n            'X-CSRF-TOKEN': $('meta[name=\"csrf-token\"]').attr('content')\n        }\n    });\n    $('#addProfession').find('button').click(function () {\n\n        var currentNode = $(this);\n        if ($('#addProfession').find('input').val() == '') {\n            $('#addProfession').append('<span class=\"text-danger\">请添加专业名称</span>');\n        } else {\n            $.ajax({\n                type: 'post',\n                url: '/users/' + $('#wrap-id').data('user-id') + '/admin/professions',\n                data: { name: $('#addProfession').find('input').val() },\n                success: function success(data) {\n                    $('#profession-table tbody').append('\\n                    <tr>\\n                        <td>New</td>\\n                        <td>' + data.profession.name + '</td>\\n                        <td>\\n                            <button class=\"btn btn-danger\" data-profession-id=\"' + data.profession.id + '\">\\u5220\\u9664</button>\\n                        </td>\\n                    </tr>');\n                    $('#addProfession').find('input').val('');\n                }\n            });\n        }\n    });\n    //删除职业\n    $('#profession-table').delegate('button', 'click', function () {\n        var that = $(this);\n        $.ajax({\n            type: 'delete',\n            url: '/users/' + $('#wrap-id').data('user-id') + 'admin/professions/' + $('#profession-table button').attr('data-profession-id'),\n            success: function success(data) {\n                that.parent().parent().remove();\n            }\n        });\n    });\n\n    $('.delete-article').click(function () {\n        var current_article = $(this);\n        if (confirm('确认删除该文章吗？')) {\n            $.ajax({\n                type: 'delete',\n                url: '/users/' + $('#user-card').data('user-id') + '/articles/' + $(this).parent().parent().attr('data-article-id'),\n                success: function success(data) {\n                    if (data.status == '0') {\n                        current_article.parent().parent().fadeOut();\n                    }\n                }\n            });\n        }\n    });\n\n    $('.removeProfession').click(function () {\n        var currentNode = $(this);\n        var professionId = currentNode.parent().data('profession-id');\n        $.ajax({\n            type: 'delete',\n            url: '/professions/' + professionId,\n            success: function success(data) {\n                currentNode.parent().fadeOut();\n            }\n        });\n    });\n\n    $('#add-category').click(function () {\n        if ($(this).prev().find('input').val() == '') {\n            $(this).prev().find('input').focus().end().parent().append('<span class=\"text-danger\">主菜单名称不能为空</span>');\n        } else {\n            var current_cate = $(this);\n            $.ajax({\n                type: 'post',\n                url: '/users/' + $('#user-card').data('user-id') + '/categories',\n                data: { parent_id: 0, name: $(this).prev().find('input').val() },\n                dataType: 'json',\n                success: function success(data) {\n                    $('#category_list').append('<hr>' + '<li data-category-id=\"' + data.id + '\">' + data.name + '<span onclick=\"deleteCate()\"><i class=\"fa fa-times\" aria-hidden=\"true\"></i></span>' + '<fieldset class=\"form-inline\">' + '<div class=\"form-group\">' + '<div class=\"input-group\">' + '<input class=\"form-control\" placeholder=\"添加子菜单\" required=\"required\" name=\"category\" type=\"text\">' + '<div class=\"input-group-addon\">' + '<i class=\"fa fa-check-square-o\" aria-hidden=\"true\">' + '</i>' + '</div>' + '</div>' + '</div>' + '' + ' <button class=\"btn btn-info\" onclick=\"addChildCate($(this))\">添加子菜单</button>' + '</fieldset>' + '<ul></ul>' + '</li>');\n                    current_cate.prev().find('input').val('');\n                }\n            });\n        };\n    });\n\n    // $('.child-cate-btn').click(function () {\n    //    if( $(this).parent().find('input').val()=='' ){\n    //        $(this).parent().find('input').focus();\n    //        $(this).parent().append('<span class=\"text-danger\">子菜单不能能空</span>');\n    //    }else{\n    //        var current_node = $(this);\n    //         $.ajax({\n    //            type:'post',\n    //            url:'/users/'+$('#user-card').data('user-id')+'/categories',\n    //            data:{parent_id:$(this).parents('li').attr('data-category-id'),name:$(this).parent().find('input').val()},\n    //             dataType:'json',\n    //             success:function (data) {\n    //                 console.log(current_node);\n    //                 current_node.parent().next().append(\n    //                     '<li class=\"child-cate-list\" data-child-category-id=\"'+data.id+'\">'+\n    //                         data.name+''+\n    //                         '<span><i class=\"fa fa-times\" aria-hidden=\"true\"></i></span>'+\n    //                     '</li>'\n    //                 );\n    //                 current_node.parent().find('input').val('');\n    //             }\n    //         });\n    //    }\n    // });\n\n    $('#commentBtn').click(function () {\n        $.ajax({\n            type: 'post',\n            url: '/comments',\n            dataType: 'json',\n            data: { article_id: $('#article').data('article-id'), content: $('#markdown').val(), parent_id: 0 },\n            success: function success(data) {\n                $('#commentList').append('<div class=\"meida\">' + '<a href=\"\" class=\"media-left\">' + '<img src=\"' + $('#imgUrl').attr('src') + '\" alt=\"\" width=\"80\" height=\"80\">' + '</a>' + '<div class=\"media-body\" data-comment-id=\"' + data.commentId + '\">' + '<h6 class=\"media-heading\">' + $('#userName').text() + '<small>' + data.createdAt + ' #' + data.floor + '</small>' + '</h6>' + data.content + '<div class=\"text-xs-right\">' + '<button class=\"btn btn-outline-info reply\">' + '回复' + '</button>' + '</div>' + '</div>' + '</div>' + '<hr>');\n                $('#markdown').val('');\n            }\n        });\n    });\n    //启动模态框\n    $('.reply').click(function () {\n        var commentId = $(this).parent().parent().attr('data-comment-id');\n        $('#myModal').attr('data-parent-id', commentId);\n        $('#myModal').modal('show');\n    });\n    $('.replyBtn').click(function () {\n        var content = $(this).parent().prev().find('textarea').val();\n        $.ajax({\n            type: 'post',\n            url: '/comments',\n            dataType: 'json',\n            data: { article_id: $('#article').data('article-id'), content: content, parent_id: $('#myModal').attr('data-parent-id') },\n            success: function success(data) {\n                $('#commentList').append('<div class=\"meida\">' + '<a href=\"\" class=\"media-left\">' + '<img src=\"' + $('#imgUrl').attr('src') + '\" alt=\"\" width=\"80\" height=\"80\">' + '</a>' + '<div class=\"media-body\" data-comment-id=\"' + data.commentId + '\">' + '<h6 class=\"media-heading\">' + $('#userName').text() + '<small>' + data.createdAt + '</small>' + '</h6>' + data.content + '<div class=\"text-xs-right\">' + '<button class=\"btn btn-outline-info reply\">' + '回复' + '</button>' + '</div>' + '</div>' + '</div>' + '<hr>');\n                $('#myModal').modal('hide').find('textarea').val('');\n            }\n        });\n    });\n\n    $('#support').click(function () {\n        $.ajax({\n            type: 'post',\n            url: '/articles/' + $('#article').data('article-id') + '/support',\n            dataType: 'json',\n            success: function success(data) {\n                $('#supportCount').text(data.supportCount);\n            }\n        });\n    });\n    $('#unsupport').click(function () {\n        $.ajax({\n            type: 'post',\n            url: '/articles/' + $('#article').data('article-id') + '/unsupport',\n            dataType: 'json',\n            success: function success(data) {\n                $('#unsupportCount').text(data.unsupportCount);\n            }\n        });\n    });\n\n    $('#likeable').click(function () {\n        if ($('#likeable').attr('data-likeable-id') == '0') {\n            $.ajax({\n                type: 'post',\n                url: '/likeables',\n                dataType: 'json',\n                data: { article_id: $('#article').data('article-id') },\n                success: function success(data) {\n                    $('#likeable').toggleClass('fa-heart-o fa-heart').attr('data-likeable-id', data.likeableId);\n                    $('#likeCount').text(data.likeCount);\n                }\n            });\n        } else {\n            $.ajax({\n                type: 'delete',\n                url: '/likeables/' + $('#likeable').attr('data-likeable-id'),\n                dataType: 'json',\n                data: { likeable_id: $('#likeable').attr('data-likeable-id'), article_id: $('#article').data('article-id'), _method: 'delete' },\n                success: function success(data) {\n                    $('#likeable').toggleClass('fa-heart-o fa-heart').attr('data-likeable-id', 0);\n                    $('#likeCount').text(data.likeCount);\n                }\n            });\n        }\n    });\n\n    $('#collect').click(function () {\n        if ($('#collect').attr('data-collect-id') == '0') {\n            $.ajax({\n                type: 'post',\n                url: '/collects',\n                dataType: 'json',\n                data: { article_id: $('#article').data('article-id') },\n                success: function success(data) {\n                    $('#collect').removeClass('btn-default').addClass('btn-danger').attr('data-collect-id', data.data.id);\n                    $('#collect>span').text(' 已收藏');\n                }\n            });\n        } else {\n            $.ajax({\n                type: 'delete',\n                url: '/collects/' + $('#collect').attr('data-collect-id'),\n                dataType: 'json',\n                data: { article_id: $('#article').data('article-id'), _method: 'delete' },\n                success: function success(data) {\n                    $('#collect').addClass('btn-default').removeClass('btn-danger').attr('data-collect-id', 0);\n                    $('#collect>span').text(' 收藏');\n                }\n            });\n        }\n    });\n});\n\n},{}]},{},[1]);\n"],"file":"application.js"}